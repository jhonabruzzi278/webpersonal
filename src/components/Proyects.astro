---
import { getCollection } from "astro:content";
import ProjectCard from "./ProjectCard.astro";
import { getLangFromUrl, useTranslations } from '../utils/i18n';

// Obtener el idioma actual
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Obtener proyectos filtrados por idioma
let allProjects;
try {
  allProjects = await getCollection("projects", ({ id }) => {
    if (lang === 'es') {
      return !id.startsWith('en/');
    } else {
      return id.startsWith('en/');
    }
  });
} catch (error) {
  // Fallback a todos los proyectos si hay error
  allProjects = await getCollection("projects");
}

// Filtrar para mostrar solo el proyecto de la clÃ­nica dentista
const featuredProject = allProjects.filter(
  (project) => project.slug === "clinica-dentista" || project.slug === "en/clinica-dentista"
)[0];
---

<div class="flex flex-col gap-y-8">
  {
    featuredProject && (
      <div class="grid grid-cols-1 max-w-2xl mx-auto">
        <ProjectCard
          title={featuredProject.data.title}
          href={featuredProject.data.link}
          github={featuredProject.data.github}
          imageSrc={featuredProject.data.image}
          imageAlt={featuredProject.data.title}
          descriptionHTML={featuredProject.body || "Proyecto destacado"}
          techs={featuredProject.data.tags}
        />
      </div>
    )
  }

  <!-- Enlace llamativo para ver todos los proyectos -->
  <div class="text-center pt-6">
    <a
      class="group relative inline-flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-3 rounded-lg transition-all duration-200 hover:scale-105"
      href={lang === 'es' ? '/proyectos' : '/en/projects'}
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
      <span>
        {t('projects.view-all')}
      </span>
    </a>
  </div>
</div>
